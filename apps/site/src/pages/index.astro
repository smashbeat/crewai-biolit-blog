---
import Base from "../layouts/Base.astro";
import { getCollection } from "astro:content";

// inline slugify identical to tags/[tag].astro
function slugify(s) {
  return String(s)
    .toLowerCase()
    .normalize('NFKD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/(^-|-$)+/g, '');
}

const posts = await getCollection("posts");
const tagsSet = new Set(posts.flatMap(p => p.data.tags || []));
const tags = Array.from(tagsSet)
  .map(t => ({ label: t, slug: slugify(t) }))
  .sort((a, b) => a.label.localeCompare(b.label));
---

<Base title="Posts">
  <h1>Latest posts</h1>
  <ul>
    {posts.map(p => (
      <li>
        <a href={`/posts/${p.slug}/`}>{p.data.title ?? p.slug}</a>
      </li>
    ))}
  </ul>

  <h2 class="mt-8">Tags</h2>
  <ul>
    {tags.map(t => (
      <li><a href={`/tags/${t.slug}/`}>{t.label}</a></li>
    ))}
  </ul>
</Base>
