---
import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const all = await getCollection("posts");
  const tags = Array.from(new Set(all.flatMap(p => p.data.tags || [])));
  return tags.map(tag => ({ params: { tag } }));
}

const { tag } = Astro.params;
const all = await getCollection("posts");
const posts = all.filter(p => (p.data.tags || []).includes(tag));
---

<Base title={`#${tag}`}>
  <h1>Posts tagged “{tag}”</h1>
  <ul>
    {posts.map(p => (
      <li>
        <a href={`/posts/${p.slug}/`}>{p.data.title ?? p.slug}</a>
      </li>
    ))}
  </ul>
</Base>
